import{_ as le,r as z,d as te,o as V,c as N,u as g,F as ue,n as ce,w as fe,a as u,b as de,e as ge,f as me,g as k,v as I,t as R}from"./index.fe5a49ec.js";const E=Object.freeze({loadFile(e){return new Promise((n,t)=>{const r=new FileReader;r.onload=a=>{var d;r.onload=null,r.onabort=null,r.onerror=null;const c=(d=a.target)==null?void 0:d.result;if(!c)return t(a);n(c)},r.onabort=r.onerror=a=>{r.onload=null,r.onabort=null,r.onerror=null,t(a)},e(r)})},checkFileType(e,n){const{type:t}=e;for(let r=0;r<n.length;r++)if(t!=null&&t.startsWith(n[r]))return!0;return!1},checkFileSuffix(e,n){var a,c;const{name:t}=e,r=(a=t.split(".").pop())==null?void 0:a.toUpperCase();for(let d=0;d<n.length;d++)if(r===((c=n[d])==null?void 0:c.toUpperCase()))return!0;return!1},async selectFile(e,n){const{fileOpen:t}=await le(()=>import("./index.modern.cf7231ff.js"),[],import.meta.url);return await t({extensions:e,description:n,excludeAcceptAllOption:!1})},arrayBufferToBlob(e,n){return E.blobToUrl(new Blob([e],{type:n}))},base64ToBlob(e){const n=e.split(","),t=n[0].match(/:(.*?);/)[1],r=atob(n[1]);let a=r.length;const c=new Uint8Array(a);for(;a--;)c[a]=r.charCodeAt(a);return new Blob([c],{type:t})},blobToBase64(e){return E.loadFile(n=>n.readAsDataURL(e))},blobToUrl(e){return URL.createObjectURL(e)},revokeUrl(e){URL.revokeObjectURL(e)}}),X=Object.freeze({load(e){return new Promise((n,t)=>{if(!e)return t("src empty");const r=new Image;r.onload=()=>{r.onload=null,r.onerror=null,n(r)},r.onerror=a=>{r.onload=null,r.onerror=null,t(a)},r.src=e,r.complete&&(r.onload=null,r.onerror=null,n(r))})},scaleImageRect(e,n,t){const{width:r,height:a}=e,c=Math.min(n/r,t/a),d=Math.floor(r*c),l=Math.floor(a*c),m=Math.floor((t-l)/2),b=Math.floor((n-d)/2);return{width:d,height:l,x:b,y:m}}});function be(e,n){const t=z(!1);function r(l){l.preventDefault(),t.value=!0}function a(){t.value=!1}function c(l){var p;l.preventDefault(),a();const m=l.dataTransfer;if(!m)return;const b=(p=m.files)==null?void 0:p[0];!b||E.checkFileSuffix(b,e)||n(b)}function d(){E.selectFile(e,"Tetap").then(l=>{E.checkFileSuffix(l,e)||n(l)})}return{isDown:t,dragover:r,dragleave:a,drop:c,click:d}}const pe=u("div",null,"\u653E\u5165\u6587\u4EF6/\u9009\u62E9\u6587\u4EF6",-1),he=u("div",{class:"text-sm mt-2"},"\u652F\u6301\u56FE\u7247/\u89C6\u9891",-1),ye={key:1},we=te({__name:"DropFile",emits:["change"],setup(e,{emit:n}){const t=z(!1),r=[".jpg",".jpeg",".png",".bmp",".webp",".mp4"],{isDown:a,dragover:c,dragleave:d,drop:l,click:m}=be(r,b=>{t.value=!0,n("change",b)});return(b,p)=>(V(),N("div",{class:ce(["absolute top-0 left-0 w-full h-full flex flex-col cursor-pointer items-center justify-center px-4 py-16 text-gray-600 text-3xl font-semibold bg-gray-100 border-2 border-gray-200 border-dashed",[{"bg-gray-200":g(a),"border-gray-300":g(a)},t.value?"opacity-0":"opacity-100"]]),onDragover:p[0]||(p[0]=(...y)=>g(c)&&g(c)(...y)),onDragleave:p[1]||(p[1]=(...y)=>g(d)&&g(d)(...y)),onDrop:p[2]||(p[2]=fe((...y)=>g(l)&&g(l)(...y),["stop","prevent"])),onClick:p[3]||(p[3]=(...y)=>g(m)&&g(m)(...y))},[g(a)?(V(),N("div",ye,"\u653E\u5165\u6587\u4EF6")):(V(),N(ue,{key:0},[pe,he],64))],34))}});var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var H=ve,_e=typeof B=="object"&&B&&B.Object===Object&&B,xe=_e,Te=xe,Ee=typeof self=="object"&&self&&self.Object===Object&&self,je=Te||Ee||Function("return this")(),ne=je,Fe=ne,Oe=function(){return Fe.Date.now()},Ue=Oe,ke=/\s/;function Ie(e){for(var n=e.length;n--&&ke.test(e.charAt(n)););return n}var Re=Ie,Se=Re,Ae=/^\s+/;function $e(e){return e&&e.slice(0,Se(e)+1).replace(Ae,"")}var Le=$e,Me=ne,De=Me.Symbol,re=De,J=re,ae=Object.prototype,Ce=ae.hasOwnProperty,We=ae.toString,A=J?J.toStringTag:void 0;function Be(e){var n=Ce.call(e,A),t=e[A];try{e[A]=void 0;var r=!0}catch{}var a=We.call(e);return r&&(n?e[A]=t:delete e[A]),a}var Ve=Be,Ne=Object.prototype,Pe=Ne.toString;function Ge(e){return Pe.call(e)}var ze=Ge,K=re,He=Ve,qe=ze,Xe="[object Null]",Je="[object Undefined]",Q=K?K.toStringTag:void 0;function Ke(e){return e==null?e===void 0?Je:Xe:Q&&Q in Object(e)?He(e):qe(e)}var Qe=Ke;function Ye(e){return e!=null&&typeof e=="object"}var Ze=Ye,et=Qe,tt=Ze,nt="[object Symbol]";function rt(e){return typeof e=="symbol"||tt(e)&&et(e)==nt}var at=rt,ot=Le,Y=H,it=at,Z=0/0,st=/^[-+]0x[0-9a-f]+$/i,lt=/^0b[01]+$/i,ut=/^0o[0-7]+$/i,ct=parseInt;function ft(e){if(typeof e=="number")return e;if(it(e))return Z;if(Y(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Y(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=ot(e);var t=lt.test(e);return t||ut.test(e)?ct(e.slice(2),t?2:8):st.test(e)?Z:+e}var dt=ft,gt=H,G=Ue,ee=dt,mt="Expected a function",bt=Math.max,pt=Math.min;function ht(e,n,t){var r,a,c,d,l,m,b=0,p=!1,y=!1,O=!0;if(typeof e!="function")throw new TypeError(mt);n=ee(n)||0,gt(t)&&(p=!!t.leading,y="maxWait"in t,c=y?bt(ee(t.maxWait)||0,n):c,O="trailing"in t?!!t.trailing:O);function U(f){var x=r,_=a;return r=a=void 0,b=f,d=e.apply(_,x),d}function C(f){return b=f,l=setTimeout(o,n),p?U(f):d}function v(f){var x=f-m,_=f-b,W=n-x;return y?pt(W,c-_):W}function s(f){var x=f-m,_=f-b;return m===void 0||x>=n||x<0||y&&_>=c}function o(){var f=G();if(s(f))return i(f);l=setTimeout(o,v(f))}function i(f){return l=void 0,O&&r?U(f):(r=a=void 0,d)}function T(){l!==void 0&&clearTimeout(l),b=0,r=m=a=l=void 0}function h(){return l===void 0?d:i(G())}function j(){var f=G(),x=s(f);if(r=arguments,a=this,m=f,x){if(l===void 0)return C(m);if(y)return clearTimeout(l),l=setTimeout(o,n),U(m)}return l===void 0&&(l=setTimeout(o,n)),d}return j.cancel=T,j.flush=h,j}var yt=ht,wt=yt,vt=H,_t="Expected a function";function xt(e,n,t){var r=!0,a=!0;if(typeof e!="function")throw new TypeError(_t);return vt(t)&&(r="leading"in t?!!t.leading:r,a="trailing"in t?!!t.trailing:a),wt(e,n,{leading:r,maxWait:n,trailing:a})}var Tt=xt;let w,$=null;function oe(){return($===null||$.byteLength===0)&&($=new Uint8Array(w.memory.buffer)),$}function Et(e,n){return e=e>>>0,oe().subarray(e/1,e/1+n)}const F=new Array(128).fill(void 0);F.push(void 0,null,!0,!1);function P(e){return F[e]}let L=F.length;function jt(e){e<132||(F[e]=L,L=e)}function Ft(e){const n=P(e);return jt(e),n}let S=0;function M(e,n){const t=n(e.length*1,1)>>>0;return oe().set(e,t/1),S=e.length,t}function D(e){L===F.length&&F.push(F.length+1);const n=L;return L=F[n],F[n]=e,n}function Ot(e,n){var t=M(e,w.__wbindgen_malloc),r=S;w.grayscale_strength(t,r,D(e),n)}function Ut(e,n){var t=M(e,w.__wbindgen_malloc),r=S;w.hue(t,r,D(e),n)}function kt(e,n){var t=M(e,w.__wbindgen_malloc),r=S;w.saturation(t,r,D(e),n)}function It(e,n){var t=M(e,w.__wbindgen_malloc),r=S;w.heat_up(t,r,D(e),n)}function Rt(e,n,t){var r=M(e,w.__wbindgen_malloc),a=S;w.promotion(r,a,D(e),n,t)}async function St(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function At(){const e={};return e.wbg={},e.wbg.__wbindgen_copy_to_typed_array=function(n,t,r){new Uint8Array(P(r).buffer,P(r).byteOffset,P(r).byteLength).set(Et(n,t))},e.wbg.__wbindgen_object_drop_ref=function(n){Ft(n)},e}function $t(e,n){return w=e.exports,ie.__wbindgen_wasm_module=n,$=null,w}async function ie(e){if(w!==void 0)return w;typeof e>"u"&&(e=new URL(""+new URL("image_bg.1316ac51.wasm",import.meta.url).href,self.location));const n=At();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:r}=await St(await e,n);return $t(t,r)}const Lt={class:"max-w-5xl mx-auto py-6 px-4 flex flex-col h-screen"},Mt={class:"flex-1 relative rounded-md overflow-hidden"},Dt={class:"flex-none mt-3 py-6 px-4 bg-gray-100 rounded-md space-y-6"},Ct=u("div",{class:"text-2xl font-bold"},"\u8BBE\u7F6E",-1),Wt={class:"flex items-center space-x-3 text-sm"},Bt=u("div",{class:"flex-none w-14"},"\u4EAE\u5EA6",-1),Vt={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},Nt={class:"flex items-center space-x-3 text-sm"},Pt=u("div",{class:"flex-none w-14"},"\u5BF9\u6BD4\u5EA6",-1),Gt={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},zt={class:"flex items-center space-x-3 text-sm"},Ht=u("div",{class:"flex-none w-14"},"\u9971\u548C\u5EA6",-1),qt={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},Xt={class:"flex items-center space-x-3 text-sm"},Jt=u("div",{class:"flex-none w-14"},"\u8272\u76F8",-1),Kt={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},Qt={class:"flex items-center space-x-3 text-sm"},Yt=u("div",{class:"flex-none w-14"},"\u52A0\u6E29",-1),Zt={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},en={class:"flex items-center space-x-3 text-sm"},tn=u("div",{class:"flex-none w-14"},"\u7070\u5EA6",-1),nn={class:"bg-gray-300 text-center w-14 rounded-lg py-1 flex-none"},an=te({__name:"HomeView",setup(e){const n=z();let t,r;const a=de({brightness:0,contrast:0,saturation:0,hue:0,heatUp:0,grayscale:0});ge(()=>{if(t=n.value,!t)throw new Error("canvas not found");if(r=t.getContext("2d",{willReadFrequently:!0}),!r)throw new Error("ctx not found");C(),window.addEventListener("resize",()=>C)});let c=!1;async function d(){c||(await ie(),c=!0)}const l=new Map;let m;async function b(s){if(!t||!r||!s)return;const o=E.checkFileType(s,["image"]),i=E.checkFileType(s,["video"]);o?p(s):i&&y(s)}async function p(s){var x;if(!t||!r||!s)return;l.forEach(_=>{_!=null&&_.video&&_.video.pause()});let o=(x=l.get(s))==null?void 0:x.image;if(m=s,!o){const W=await E.loadFile(se=>se.readAsDataURL(s)),q=await X.load(W);l.clear(),l.set(s,{image:q}),o=q}const{x:i,y:T,width:h,height:j}=X.scaleImageRect(o,t.width,t.height);r.clearRect(0,0,t.width,t.height),r.drawImage(o,i,T,h,j);const f=r.getImageData(0,0,t.width,t.height);await U(f),r.putImageData(f,0,0)}async function y(s){var i;if(!t||!r||!s)return;let o=(i=l.get(s))==null?void 0:i.video;if(!o){const T=await E.loadFile(j=>j.readAsDataURL(s)),h=document.createElement("video");h.src=E.blobToUrl(E.base64ToBlob(T)),h.controls=!1,h.volume=0,h.muted=!0,h.loop=!0,h.addEventListener("play",()=>{console.log("play"),O(h)},!1),l.clear(),l.set(s,{video:h}),o=h}await o.play()}function O(s){requestAnimationFrame(async()=>{if(s.paused||s.ended)return;const{videoWidth:o,videoHeight:i}=s;if(o!==0&&i!==0){s.width=o,s.height=i;const T=Math.min(t.width/o,t.height/i),h=Math.floor(o*T),j=Math.floor(i*T),f=Math.floor((t.height-j)/2),x=Math.floor((t.width-h)/2);r.clearRect(0,0,t.width,t.height),r.drawImage(s,x,f,h,j);const _=r.getImageData(0,0,t.width,t.height);await U(_),r.putImageData(_,0,0)}O(s)})}async function U(s){await d();const o=Object.keys(a).filter(T=>a[T]!==0);let i=!1;for(const T of o)switch(T){case"brightness":case"contrast":if(i)break;i=!0,Rt(s.data,a.brightness/100,a.contrast/100);break;case"saturation":kt(s.data,a.saturation/100);break;case"hue":Ut(s.data,Math.floor(a.hue/360*100));break;case"heatUp":It(s.data,a.heatUp/100);break;case"grayscale":Ot(s.data,a.grayscale/100);break}return s}function C(){const s=t==null?void 0:t.getBoundingClientRect();s&&t&&(t.width=s.width,t.height=s.height)}const v=Tt(()=>{b(m)},300);return(s,o)=>(V(),N("div",Lt,[u("div",Mt,[u("canvas",{ref_key:"canvas",ref:n,style:{width:"100%",height:"100%"}},null,512),me(we,{onChange:b})]),u("div",Dt,[Ct,u("div",Wt,[Bt,k(u("input",{type:"range",min:-100,max:100,class:"flex-1 w-full","onUpdate:modelValue":o[0]||(o[0]=i=>a.brightness=i),onInput:o[1]||(o[1]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.brightness,void 0,{number:!0}]]),u("div",Vt,R(a.brightness),1)]),u("div",Nt,[Pt,k(u("input",{type:"range",min:-100,max:100,class:"flex-1 w-full","onUpdate:modelValue":o[2]||(o[2]=i=>a.contrast=i),onInput:o[3]||(o[3]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.contrast,void 0,{number:!0}]]),u("div",Gt,R(a.contrast),1)]),u("div",zt,[Ht,k(u("input",{type:"range",min:-100,max:100,class:"flex-1 w-full","onUpdate:modelValue":o[4]||(o[4]=i=>a.saturation=i),onInput:o[5]||(o[5]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.saturation,void 0,{number:!0}]]),u("div",qt,R(a.saturation),1)]),u("div",Xt,[Jt,k(u("input",{type:"range",min:0,max:360,class:"flex-1 w-full","onUpdate:modelValue":o[6]||(o[6]=i=>a.hue=i),onInput:o[7]||(o[7]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.hue,void 0,{number:!0}]]),u("div",Kt,R(a.hue),1)]),u("div",Qt,[Yt,k(u("input",{type:"range",min:0,max:100,class:"flex-1 w-full","onUpdate:modelValue":o[8]||(o[8]=i=>a.heatUp=i),onInput:o[9]||(o[9]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.heatUp,void 0,{number:!0}]]),u("div",Zt,R(a.heatUp),1)]),u("div",en,[tn,k(u("input",{type:"range",min:0,max:100,class:"flex-1 w-full","onUpdate:modelValue":o[10]||(o[10]=i=>a.grayscale=i),onInput:o[11]||(o[11]=(...i)=>g(v)&&g(v)(...i))},null,544),[[I,a.grayscale,void 0,{number:!0}]]),u("div",nn,R(a.grayscale),1)])])]))}});export{an as default};
